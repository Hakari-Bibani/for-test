<!DOCTYPE html>
<html>
<head>
  <style>
    .container {
      width: 100%;
      height: 500px;
      background: #f5f5f5;
      position: relative;
    }
    
    #solution {
      fill: #e6f3ff; /* Initial color */
    }
    
    #drop {
      opacity: 0;
      transform: translateY(0);
      transition: transform 0.8s ease, opacity 0.8s ease;
    }
    
    @keyframes dropFall {
      0% {
        transform: translateY(0);
        opacity: 1;
      }
      100% {
        transform: translateY(150px);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <svg width="100%" height="100%" viewBox="0 0 800 500">
      <!-- Background -->
      <rect width="800" height="500" fill="#f5f5f5"/>
      
      <!-- Burette -->
      <g id="burette">
        <!-- Burette body -->
        <rect x="350" y="50" width="40" height="250" fill="none" stroke="#333" stroke-width="2"/>
        <!-- Burette top -->
        <rect x="340" y="30" width="60" height="20" fill="#333"/>
        <!-- Burette tip -->
        <path d="M370 300 L380 320 L360 320 Z" fill="#333"/>
        <!-- Scale marks -->
        <g stroke="#333" stroke-width="1">
          <line x1="340" y1="70" x2="345" y2="70"/>
          <line x1="340" y1="120" x2="345" y2="120"/>
          <line x1="340" y1="170" x2="345" y2="170"/>
          <line x1="340" y1="220" x2="345" y2="220"/>
          <line x1="340" y1="270" x2="345" y2="270"/>
        </g>
        <!-- Solution in burette -->
        <rect id="burette-solution" x="351" y="51" width="38" height="200" fill="#e6f3ff"/>
      </g>
      
      <!-- Dropping solution -->
      <circle id="drop" cx="370" cy="325" r="3" fill="#e6f3ff"/>
      
      <!-- Flask -->
      <g id="flask">
        <!-- Flask body -->
        <path d="M300 450 Q270 450 250 420 L250 380 Q250 350 300 350 L440 350 Q490 350 490 380 L490 420 Q470 450 440 450 Z" 
              fill="none" stroke="#333" stroke-width="2"/>
        <!-- Solution in flask -->
        <path id="solution" 
              d="M252 420 L252 382 Q252 352 300 352 L440 352 Q488 352 488 382 L488 420 Q468 448 440 448 L300 448 Q272 448 252 420 Z" 
              fill="#e6f3ff"/>
      </g>
      
      <!-- Stand -->
      <g id="stand">
        <!-- Base -->
        <rect x="150" y="470" width="200" height="20" fill="#666"/>
        <!-- Pole -->
        <rect x="200" y="20" width="20" height="450" fill="#666"/>
        <!-- Clamp -->
        <path d="M220 150 L330 150 L330 180 L220 180 Z" fill="#666"/>
      </g>
    </svg>
  </div>

  <script>
    let dropCount = 0;
    const maxDrops = 5; // Number of drops before the color changes
    const drop = document.getElementById('drop');
    const solution = document.getElementById('solution');

    function addDrop() {
      // Animate the drop
      drop.style.opacity = 1;
      drop.style.transform = 'translateY(150px)';
      
      // Reset the drop after animation
      setTimeout(() => {
        drop.style.opacity = 0;
        drop.style.transform = 'translateY(0)';
        dropCount++;
        
        // Change the color of the solution in the flask after maxDrops
        if (dropCount >= maxDrops) {
          solution.style.fill = '#ffcce6'; // Change to pink
        }
      }, 800); // Duration of the drop animation
    }

    function startExperiment() {
      let interval = setInterval(() => {
        if (dropCount < maxDrops) {
          addDrop();
        } else {
          clearInterval(interval);
        }
      }, 1000); // Interval between each drop
    }

    // Add this function to your Streamlit component
    window.addEventListener('message', function(event) {
      if (event.data.type === 'start_experiment') {
        startExperiment();
      }
    });
  </script>
</body>
</html>
